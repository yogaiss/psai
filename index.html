<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>WebGIS CONTOH</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Leaflet & Plugin CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-measure/dist/leaflet-measure.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.fullscreen/Control.FullScreen.css" />
  <style>
    #map { height: 100vh; }
    .legend {
      background: white;
      padding: 6px;
      font-size: 12px;
      line-height: 1.5;
    }
  </style>
</head>
<body>
  <div id="map"></div>

  <!-- Leaflet & Plugins -->
  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-providers"></script>
  <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>
  <script src="https://unpkg.com/leaflet-measure/dist/leaflet-measure.js"></script>
  <script src="https://unpkg.com/leaflet-minimap/dist/Control.MiniMap.min.js"></script>
  <script src="https://unpkg.com/leaflet-compass/dist/leaflet-compass.min.js"></script>
  <script src="https://unpkg.com/leaflet.fullscreen/Control.FullScreen.js"></script>

  <script>
    const map = L.map('map', { fullscreenControl: true }).setView([-2.5, 117.5], 5);

    // --- BASEMAP ---
    const baseLayers = {
      "OpenStreetMap": L.tileLayer.provider('OpenStreetMap.Mapnik').addTo(map),
      "Google Satellite": L.tileLayer.provider('Esri.WorldImagery'),
      "Topographic": L.tileLayer.provider('OpenTopoMap')
    };

    // --- STYLE DAN FILE LAYER GEOJSON ---
    const geojsonLayers = [
      {
        name: "Sesar Aktif PuSGeN 2017",
        file: "SesarAktifPuSGeN2017_9.JSON",
        color: "red",
        dash: ""
      },
      {
        name: "Sesar Terindikasi Aktif",
        file: "SesarTerindikasiAktif_8.JSON",
        color: "orange",
        dash: "5,5"
      }
      // âž• Tambah layer baru di sini (cukup copy & edit baris ini)
    ];

    const overlayLayers = {};

    function createPopup(feature) {
      const props = feature.properties;
      let html = "<table>";
      for (let key in props) {
        html += `<tr><td><strong>${key}</strong></td><td>${props[key]}</td></tr>`;
      }
      html += "</table>";
      return html;
    }

    geojsonLayers.forEach(layer => {
      const geojson = L.geoJSON(null, {
        style: {
          color: layer.color,
          weight: 2,
          dashArray: layer.dash
        },
        onEachFeature: function (feature, layerObj) {
          layerObj.bindPopup(createPopup(feature));
        }
      });

      fetch(layer.file)
        .then(res => res.json())
        .then(data => {
          geojson.addData(data);
          map.addLayer(geojson);
          overlayLayers[layer.name] = geojson;
          if (layer === geojsonLayers[0]) map.fitBounds(geojson.getBounds());
        });
    });

    // --- CONTROL ---
    L.control.layers(baseLayers, overlayLayers).addTo(map);
    L.Control.geocoder().addTo(map);
    L.control.measure({ primaryLengthUnit: 'kilometers' }).addTo(map);
    new L.Control.MiniMap(L.tileLayer.provider('OpenStreetMap.Mapnik'), { toggleDisplay: true }).addTo(map);
    L.control.compass({ autoActive: true }).addTo(map);

    // --- LEGEND ---
    L.control({ position: "bottomright" }).onAdd = function () {
      const div = L.DomUtil.create("div", "legend");
      div.innerHTML = "<strong>Legenda</strong><br>";
      geojsonLayers.forEach(l => {
        div.innerHTML += `<i style="background:${l.color};width:12px;height:2px;display:inline-block;margin-right:4px;"></i>${l.name}<br>`;
      });
      return div;
    }.addTo(map);

    // --- KOORDINAT MOUSE ---
    L.control.mousePosition = function (opts = {}) {
      const control = L.control({ position: opts.position || 'bottomleft' });
      control.onAdd = function () {
        const container = L.DomUtil.create('div');
        map.on('mousemove', function (e) {
          container.innerHTML = `Koordinat: ${e.latlng.lat.toFixed(5)}, ${e.latlng.lng.toFixed(5)}`;
        });
        return container;
      };
      return control;
    };
    L.control.mousePosition().addTo(map);
  </script>
</body>
</html>
